<nav id="mainNavbar" class="navbar navbar-light navbar-fixed-top navbar-expand-lg custom fixed-top">
    <a class="navbar-brand" [routerLink]="['/']">
        <span class="nav-logo-left">TyreLess</span>
        <span class="nav-logo-right">.co.za</span>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
        aria-expanded="false" aria-label="Toggle navigation" (click)="toggleCollapsed()">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navbarSupportedContent" [ngClass]="{'collapse': collapsed, 'navbar-collapse': true}" class="nav-right">
        <a class="navbar-brand ml-auto" [routerLink]="['/contactUs']">
            <span class="nav-right-text text-success">CONTACT US</span>
        </a>
    </div>
</nav>
<br>
<br>
<br>
<div class="custom header-section-40">
    <div class="container">
        <div class="row" style="max-height:80px">
            <div class="col-2 dd-col">
                <div class="btn-group w-100">
                    <button class="w-100 btn btn-secondary dropdown-toggle dd-t-custom m-0" type="button" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">
                        <div class="dd-left p-0">
                            Vehicle Type
                        </div>
                        <img src="../..{{data.selectedSrc}}" class="vehicle-icon" />
                        <span class="dd-col dd-search-text">{{ data.selected }}</span>
                        <i class="dd-caret fa fa-angle-down"></i>
                    </button>
                    <div class="w-100 dropdown-menu">
                        <button class="dropdown-item" type="button" *ngFor="let vehicle of properties.vehicleTypes" (click)="update('selectedSrc', vehicle.imageSrc); update('selected', vehicle.name)">
                            <img src="../..{{vehicle.imageSrc}}" class="vehicle-icon" /> {{ vehicle.name }}
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-1 dd-col">
                <div class="btn-group w-100">
                    <button class="w-100 btn btn-secondary dropdown-toggle dd-t-custom m-0" type="button" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">
                        <div class="dd-left p-0">
                            Tyre Width
                        </div>
                        <span class="dd-col dd-search-text">{{ data.width }}</span>
                        <i class="dd-caret fa fa-angle-down"></i>
                    </button>
                    <div class="w-100 dropdown-menu">
                        <button class="dropdown-item" type="button" *ngFor="let width of properties.tyreWidths" (click)="update('width', width)">
                            {{ width }}
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-1 dd-col">
                <div class="btn-group w-100">
                    <button class="w-100 btn btn-secondary dropdown-toggle dd-t-custom m-0" type="button" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">
                        <div class="dd-left p-0">
                            Tyre Profile
                        </div>
                        <span class="dd-col dd-search-text">{{ data.profile }}</span>
                        <i class="dd-caret fa fa-angle-down"></i>
                    </button>
                    <div class="w-100 dropdown-menu">
                        <button class="dropdown-item" type="button" *ngFor="let profile of properties.tyreProfiles" (click)="update('profile', profile)">
                            {{ profile }}
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-1 dd-col">
                <div class="btn-group w-100">
                    <button class="w-100 btn btn-secondary dropdown-toggle dd-t-custom m-0" type="button" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">
                        <div class="dd-left p-0">
                            Wheel Size
                        </div>
                        <span class="dd-col dd-search-text">{{ data.size }}</span>
                        <i class="dd-caret fa fa-angle-down"></i>
                    </button>
                    <div class="w-100 dropdown-menu">
                        <button class="dropdown-item" type="button" *ngFor="let size of properties.wheelSizes" (click)="update('size', size)">
                            {{ size }}
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-1 dd-col">
                <div class="btn-group w-100">
                    <button class="w-100 btn btn-secondary dropdown-toggle dd-t-custom m-0" type="button" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">
                        <div class="dd-left p-0">
                            Quantity
                        </div>
                        <span class="dd-col dd-search-text">{{ data.quantity }}</span>
                        <i class="dd-caret fa fa-angle-down"></i>
                    </button>
                    <div class="w-100 dropdown-menu">
                        <button class="dropdown-item" type="button" *ngFor="let quantity of properties.quantities" (click)="update('quantity', quantity)">
                            {{ quantity }}
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-2 dd-col">
                <ss-multiselect-dropdown [options]="properties.brands" [texts]="brandTexts" [settings]="dropdownSettings" [(ngModel)]="data.brand"></ss-multiselect-dropdown>
            </div>
            <div class="col-2 dd-col">
                <div class="btn-group w-100">
                    <button class="w-100 btn btn-secondary dropdown-toggle dd-t-custom m-0" type="button" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false" (click)="openLocationModal()">
                        <div class="dd-left p-0">
                            Location
                        </div>
                        <span class="dd-col dd-search-text">{{ data.location.name }}</span>
                        <i class="dd-caret"></i>
                    </button>
                </div>
            </div>
            <div class="col-2 dd-col">
                <button class="btn btn-success w-100 h-100 p-3" type="button" [routerLink]="['/search']" [queryParams]="{ selected: data.selected, width: data.width, profile: data.profile, size: data.size, quantity: data.quantity, brand: data.brand, location: data.location.highLevel, subLocations: data.location.lowLevel, wheelAlignmentChecked: data.wheelAlignmentChecked, wheelBalancingChecked: data.wheelBalancingChecked, selectedFilter: data.selectedFilter }"
                    [disabled]="!data.brand || data.brand.length==0 || data.location.name == 'Unselected'">MODIFY SEARCH</button>
            </div>
        </div>
        <div class="row text-center">
            <div class="col-3"></div>
            <div class="col-3 extras-col rounded">
                <div class="checkbox checkbox-success float-left">
                    <input id="wheelAlignmentSearch" type="checkbox" [checked]="data.wheelAlignmentChecked" (change)="data.wheelAlignmentChecked = !data.wheelAlignmentChecked">
                    <label for="wheelAlignmentSearch">
                        Wheel Alignment
                    </label>
                </div>
            </div>
            <div class="col-3 extras-col rounded">
                <div class="checkbox checkbox-success float-left">
                    <input id="wheelBalancingSearch" type="checkbox" [checked]="data.wheelBalancingChecked" (change)="data.wheelBalancingChecked = !data.wheelBalancingChecked">
                    <label for="wheelBalancingSearch">
                        Wheel Balancing
                    </label>
                </div>
            </div>
            <div class="col-3"></div>
        </div>
    </div>
</div>
<br>
<div class="results-and-filters container custom">
    <div class="row" *ngIf="!properties.results || properties.results.length == 0">
        <div class="col-12">
            <div [hidden]="properties.loading" class="text-center">
                <br>
                <br>
                <img src="../../assets/no_results.png" class="search-icon" />
                <br>
                <br>
                <h5>No Results Found</h5>
                <h6>Please refine your search</h6>
            </div>
            <div [hidden]="!properties.loading" class="text-center">
                <br>
                <br>
                <img src="../../assets/loading.gif" class="search-icon" />
                <br>
                <br>
                <h5>Searching</h5>
                <h6>Please wait...</h6>
                <br>
                <br>
            </div>
        </div>
    </div>
    <div class="row" *ngIf="properties.results && properties.results.length > 0">
        <div class="col-4" style="position: relative">
            <div style="position: absolute; bottom: 0; right:12pt">
                <a href="javascript:void(0)" (click)="resetFilters()">Reset Filter</a>
            </div>
        </div>
        <div class="col-8">
            <div class="row">
                <div class="col-6"></div>
                <div class="col-6 text-right">
                    Sort results by:
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {{data.selectedFilter}}
                            <i class="fa fa-angle-down" style="color:rgb(107,172,70)"></i>
                        </button>
                        <div class="dropdown-menu">
                            <span (click)="sort(filterName) " *ngFor="let filterName of properties.filters" class="dropdown-item">{{filterName}}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row" *ngIf="properties.results && properties.results.length > 0">
        <div class="col-4">
            <div class="row">
                <div class="col-12">
                    <div class="card m-1">
                        <div class="card-header">
                            Price
                        </div>
                        <div class="card-body filter-body p-2" id="priceSlider">
                            <div *ngIf="properties.filteredResults && properties.filteredResults.length > 0" class="p-2">
                                <mat-slider [min]="properties.priceFilter.min" [max]="properties.priceFilter.max" (change)="applyFilters('price')" [(ngModel)]="properties.priceFilter.current"></mat-slider>
                                <div class="row">
                                    <div class="col-6 text-left">
                                        <b>Min:</b> {{properties.priceFilter.min | currency:'R'}}
                                    </div>
                                    <div class="col-6 text-right">
                                        <b>Max:</b> {{properties.priceFilter.max | currency:'R'}}
                                    </div>
                                </div>
                            </div>
                            <div class="text-center" *ngIf="!properties.filteredResults || properties.filteredResults.length == 0">
                                N/A
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="card m-1">
                        <div class="card-header">
                            Type
                        </div>
                        <div class="card-body results-table filter-body p-2">
                            <div class="w-50 radio radio-success float-left">
                                <input id="typeRegular" type="radio" [checked]="data.tyreType == 'regular'" (click)="update('tyreType', 'regular'); applyFilters('type')">
                                <label for="typeRegular">
                                    Regular
                                </label>
                            </div>
                            <div class="w-50 radio radio-success float-left">
                                <input id="typeRunFlat" type="radio" [checked]="data.tyreType =='runFlat'" (click)="update('tyreType', 'runFlat'); applyFilters('type')">
                                <label for="typeRunFlat">
                                    Run Flat
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="card m-1">
                        <div class="card-header">
                            Retailer
                        </div>
                        <div class="card-body results-table filter-body p-2">
                            <div class="w-50 float-left" *ngFor="let retailer of properties.retailers; let i = index" [hidden]="!retailer.visible">
                                <div class="checkbox checkbox-success float-left">
                                    <input id="retailer{{retailer.id}}" type="checkbox" [checked]="retailer.checked" (change)="toggleRetailer(retailer)">
                                    <label for="retailer{{retailer.id}}">
                                        {{retailer.name}}
                                    </label>
                                </div>
                            </div>
                            <div class="text-center" *ngIf="!properties.retailers || properties.retailers.length == 0">
                                N/A
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="card m-1">
                        <div class="card-header">
                            Model
                        </div>
                        <div class="card-body results-table filter-body p-2">
                            <div class="card model-card m-1" [hidden]="!properties.models || properties.models.length == 0" *ngFor="let brand of properties.models" [hidden]="!brand.visible">
                                <div class="card-header text-left"><b>{{brand.brand}}</b></div>
                                <div class="card-body">
                                    <div class="w-100 float-left" *ngFor="let model of brand.models; let i = index" [hidden]="!model.visible">
                                        <div class="checkbox checkbox-success float-left">
                                            <input id="{{brand.brand}}_model_{{model.id}}" type="checkbox" [checked]="model.checked" (change)="togglelModel(model)">
                                            <label for="{{brand.brand}}_model_{{model.id}}">
                                                {{model.modelName}}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center" *ngIf="!properties.models || properties.models.length == 0">
                                N/A
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-8">
            <div class="card m-1" *ngFor="let result of properties.filteredResults">
                <div class="card-body results-table p-3">
                    <div class="row">
                        <div class="col-10">
                            <div class="row">
                                <div class="col-3 border-right">
                                    <img class="w-100" ngbTooltip="{{result.partner}}" src="../../assets/{{result.partner}}.jpg" />
                                    <br>
                                    <br> {{result.location.suburb}}, {{result.location.province}}
                                </div>
                                <div class="col-6 border-right">
                                    <div class="row">
                                        <div class="col-4 results-col text-center">
                                            <img *ngIf="!result.runFlat" class="result-tyre" src="../../assets/Tyres/{{result.brand}}_{{result.tyreModel}}_{{result.tyreWidth}}_{{result.tyreProfile}}_R{{result.wheelSize}}.jpg"
                                            />
                                            <img *ngIf="result.runFlat" class="result-tyre" src="../../assets/Tyres/{{result.brand}}_{{result.tyreModel}}_{{result.tyreWidth}}_{{result.tyreProfile}}_R{{result.wheelSize}}_Runflat.jpg"
                                            />
                                        </div>
                                        <div class="col-7 results-text results-col">
                                            {{result.brand}}
                                            <br> {{result.tyreModel}}
                                            <div class="row">
                                                <div class="col-6">
                                                    <span *ngIf="result.runFlat">Run Flat</span>
                                                </div>
                                                <div class="col-6 results-col">
                                                    <br>
                                                    <img class="result-logo w-100" ngbTooltip="{{result.brand}}" src="../../assets/Tyre Manufacturer/{{result.brand}}.png" />
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="col-3 text-center border-right">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="strong included-text rounded">Included</div>
                                        </div>
                                    </div>
                                    <div class="row" *ngFor="let service of result.partnerDetails.services">
                                        <div class="col-12 results-col" *ngIf="service.show">
                                            {{service.name}}
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-2 results-col text-center">
                            <a href="javascript:void(0)" ngbTooltip="View Breakdown" (click)="viewBreakdown(result)">
                                <i class="fa fa-info-circle"></i> View Detail
                            </a>
                            <div class="text-center p-2">
                                <div class="checkbox checkbox-success select-box rounded">
                                    <input id="select_{{result.index}}" type="checkbox" [checked]="result.contactMe" (change)="checkSelect(result)">
                                    <label for="select_{{result.index}}">
                                        SELECT
                                    </label>
                                </div>
                            </div>
                            <h6>
                                <b>{{result.totalPrice | currency:'R'}}</b>
                            </h6>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card m-1 text-center" *ngIf="properties.results && properties.results.length > 0 && properties.filteredResults.length == 0 ">
                <div class="card-body">
                    <br>
                    <img src="../../assets/no_results.png" class="search-icon" />
                    <br>
                    <br>
                    <h5>No Results Found</h5>
                    <h6>Please refine your search</h6>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="footer sticky-footer" [hidden]="!properties.showContactMe">
    <div class="container">
        <div class="row">
            <div class="col-1"></div>
            <div class="col-10">
                <div class="text-center font-weight-bold m-2">
                    Please enter your details and our Partners will contatct you regarding your selected deals
                </div>
                <form name="searchResultsContact" #searchResultsContact="ngForm">
                    <div class="row">
                        <div class="col-3 p-1">
                                <input id="searchContactName" name="searchContactName" type="text" class="form-control" placeholder="Name" [(ngModel)]="data.getContacted.name"
                                required />
                        </div>
                        <div class="col-3 p-1">
                                <input id="searchMobileNumber" name="searchMobileNumber" type="text" class="form-control" pattern="[0-9]*" minlength="10" maxlength="10" placeholder="Mobile Number" [(ngModel)]="data.getContacted.mobile"
                                required />
                        </div>
                        <div class="col-3 p-1">
                                <input id="searchEmail" name="searchEmail" type="text" class="form-control" pattern="^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$" placeholder="Email Address" [email]="true" [(ngModel)]="data.getContacted.email"
                                required />
                        </div>
                        <div class="col-3 p-1">
                            <button class="btn btn-success h-100 w-100 custom" id="contactMeBtn" type="button" [disabled]="!searchResultsContact.form.valid" (click)="submitContactForm()">CONTACT ME ></button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-1"></div>
        </div>
    </div>
</footer>

<ng-template #content let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h4 class="modal-title custom">Cost Breakdown</h4>
        <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body custom-lite">
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th scope="col">Product</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Total Cost</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let row of properties.details.breakdown" [ngClass]="{strong : row.line1 == 'Total'}">
                    <td>{{row.line1}}
                        <br>{{row.line2}}</td>
                    <td>{{row.quantity}}</td>
                    <td>{{row.totalCost | currency:'R'}}</td>
                </tr>
            </tbody>
        </table>
    </div>
</ng-template>

<ng-template #searchLocationModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h4 class="modal-title custom">Location</h4>
        <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body custom-lite custom">
        <div class="card" *ngFor="let location of properties.locations">
            <div class="card-header">
                <div class="row">
                    <div class="col-2">
                        <div class="checkbox checkbox-success checkbox-adjust">
                            <input id="{{location.name}}" type="checkbox" [checked]="location.checked" (change)="topLevelCheck(location)">
                            <label for="{{location.name}}">
                            </label>
                        </div>
                    </div>
                    <div class="col-8" (click)="location.collapsed = !location.collapsed" style="cursor: pointer;">
                        {{location.name}}
                    </div>
                </div>
            </div>
            <div class="card-body" [hidden]="location.collapsed">
                <div class="checkbox checkbox-success w-50 float-left" *ngFor="let sublocation of location.sub_locations">
                    <input id="{{sublocation.name}}" type="checkbox" [checked]="sublocation.checked" (change)="lowLevelCheck(location, sublocation)">
                    <label for="{{sublocation.name}}">
                        {{sublocation.name}}
                    </label>
                </div>
                <div class="text-center" [hidden]="location.sub_locations.length > 0">
                    None Currently
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="c('Close click')">Done</button>
    </div>
</ng-template>

<ng-template #contactFormModal let-c="close" let-d="dismiss">
        <div class="modal-header">
            <h4 class="modal-title custom">Details submitted</h4>
            <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body custom-lite text-center">
            Thanks! Your details have been submitted and our Partners will be in touch shortly
        </div>
        <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="c('Close click')">Close</button>
            </div>
    </ng-template>